<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EmployeeController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ManageEmployees</a> &gt; <a href="index.source.html" class="el_package">controller</a> &gt; <span class="el_source">EmployeeController.java</span></div><h1>EmployeeController.java</h1><pre class="source lang-java linenums">package controller;

import dao.implementations.EmployeeDAOImpl;
import entities.Employee;
import service.implementations.EmployeeServiceImpl;
import service.interfaces.EmployeeService;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.time.LocalDate;
import java.util.List;
import java.util.Optional;

@WebServlet(&quot;/employees&quot;)
<span class="nc" id="L19">public class EmployeeController extends HttpServlet {</span>

    private EmployeeService employeeService;

    @Override
    public void init() throws ServletException {
<span class="nc" id="L25">        employeeService = new EmployeeServiceImpl(new EmployeeDAOImpl());</span>
<span class="nc" id="L26">    }</span>

    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
<span class="nc" id="L30">        String action = request.getParameter(&quot;action&quot;);</span>

<span class="nc bnc" id="L32" title="All 2 branches missed.">        if (action == null) {</span>
<span class="nc" id="L33">            action = &quot;list&quot;;</span>
        }

<span class="nc bnc" id="L36" title="All 4 branches missed.">        switch (action) {</span>
            case &quot;add&quot;:
<span class="nc" id="L38">                showAddForm(request, response);</span>
<span class="nc" id="L39">                break;</span>
            case &quot;edit&quot;:
<span class="nc" id="L41">                showEditForm(request, response);</span>
<span class="nc" id="L42">                break;</span>
            case &quot;delete&quot;:
<span class="nc" id="L44">                deleteEmployee(request, response);</span>
<span class="nc" id="L45">                break;</span>
            case &quot;list&quot;:
            default:
<span class="nc" id="L48">                listEmployees(request, response);</span>
                break;
        }
<span class="nc" id="L51">    }</span>

    private void listEmployees(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
<span class="nc" id="L54">        List&lt;Employee&gt; employees = employeeService.findAllEmployees();</span>
<span class="nc" id="L55">        request.setAttribute(&quot;employees&quot;, employees);</span>
<span class="nc" id="L56">        request.getRequestDispatcher(&quot;/WEB-INF/views/employee/listEmployee.jsp&quot;).forward(request, response);</span>
<span class="nc" id="L57">    }</span>

    private void showAddForm(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
<span class="nc" id="L60">        request.getRequestDispatcher(&quot;/WEB-INF/views/employee/addEmployee.jsp&quot;).forward(request, response);</span>
<span class="nc" id="L61">    }</span>

    private void showEditForm(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
<span class="nc" id="L64">        Long id = Long.parseLong(request.getParameter(&quot;id&quot;));</span>
<span class="nc" id="L65">        Optional&lt;Employee&gt; employee = employeeService.findEmployeeById(id);</span>
<span class="nc bnc" id="L66" title="All 2 branches missed.">        if (employee.isPresent()) {</span>
<span class="nc" id="L67">            request.setAttribute(&quot;employee&quot;, employee.get());</span>
<span class="nc" id="L68">            request.getRequestDispatcher(&quot;/WEB-INF/views/employee/updateEmployee.jsp&quot;).forward(request, response);</span>
        } else {
<span class="nc" id="L70">            response.sendRedirect(&quot;employees?action=list&quot;);</span>
        }
<span class="nc" id="L72">    }</span>

    @Override
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
<span class="nc" id="L76">        String action = request.getParameter(&quot;action&quot;);</span>

<span class="nc bnc" id="L78" title="All 4 branches missed.">        switch (action) {</span>
            case &quot;save&quot;:
<span class="nc" id="L80">                saveEmployee(request, response);</span>
<span class="nc" id="L81">                break;</span>
            case &quot;update&quot;:
<span class="nc" id="L83">                updateEmployee(request, response);</span>
<span class="nc" id="L84">                break;</span>
            case &quot;delete&quot;:
<span class="nc" id="L86">                deleteEmployee(request, response);</span>
<span class="nc" id="L87">                break;</span>
            default:
<span class="nc" id="L89">                listEmployees(request, response);</span>
                break;
        }
<span class="nc" id="L92">    }</span>

    private void saveEmployee(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {
<span class="nc" id="L95">        Employee employee = extractEmployeeFromRequest(request);</span>
<span class="nc" id="L96">        employeeService.saveEmployee(employee);</span>
<span class="nc" id="L97">        response.sendRedirect(&quot;employees?action=list&quot;);</span>
<span class="nc" id="L98">    }</span>

    private void updateEmployee(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {
<span class="nc" id="L101">        Long id = Long.parseLong(request.getParameter(&quot;id&quot;));</span>
<span class="nc" id="L102">        Employee employee = extractEmployeeFromRequest(request);</span>
<span class="nc" id="L103">        employee.setId(id);</span>
<span class="nc" id="L104">        employeeService.updateEmployee(employee);</span>
<span class="nc" id="L105">        response.sendRedirect(&quot;employees?action=list&quot;);</span>
<span class="nc" id="L106">    }</span>

    private void deleteEmployee(HttpServletRequest request, HttpServletResponse response) throws IOException {
<span class="nc" id="L109">        Long id = Long.parseLong(request.getParameter(&quot;id&quot;));</span>
<span class="nc" id="L110">        Optional&lt;Employee&gt; employee = employeeService.findEmployeeById(id);</span>
<span class="nc" id="L111">        employee.ifPresent(employeeService::deleteEmployee);</span>
<span class="nc" id="L112">        response.sendRedirect(&quot;employees?action=list&quot;);</span>
<span class="nc" id="L113">    }</span>
    private Employee extractEmployeeFromRequest(HttpServletRequest request) {
<span class="nc" id="L115">        String name = request.getParameter(&quot;name&quot;);</span>
<span class="nc" id="L116">        String SSN = request.getParameter(&quot;SSN&quot;);</span>
<span class="nc" id="L117">        LocalDate birthDate = LocalDate.parse(request.getParameter(&quot;birth_date&quot;));</span>
<span class="nc" id="L118">        String password = request.getParameter(&quot;password&quot;);</span>
<span class="nc" id="L119">        LocalDate hireDate = LocalDate.parse(request.getParameter(&quot;hire_date&quot;));</span>
<span class="nc" id="L120">        int numberOfChildren = Integer.parseInt(request.getParameter(&quot;numberOfChildren&quot;));</span>
<span class="nc" id="L121">        double salary = Double.parseDouble(request.getParameter(&quot;salary&quot;));</span>
<span class="nc" id="L122">        String email = request.getParameter(&quot;email&quot;);</span>
<span class="nc" id="L123">        String phone = request.getParameter(&quot;phone&quot;);</span>
<span class="nc" id="L124">        String department = request.getParameter(&quot;department&quot;);</span>
<span class="nc" id="L125">        String position = request.getParameter(&quot;position&quot;);</span>

<span class="nc" id="L127">        int vacationDays = Integer.parseInt(request.getParameter(&quot;vacationDays&quot;));</span>
<span class="nc" id="L128">        System.out.println(&quot;Vacation Days récupérés : &quot; + vacationDays);</span>

<span class="nc" id="L130">        int vacationTaken = Integer.parseInt(request.getParameter(&quot;vacationTaken&quot;));</span>

<span class="nc" id="L132">        Employee employee = new Employee();</span>
<span class="nc" id="L133">        employee.setName(name);</span>
<span class="nc" id="L134">        employee.setSSN(SSN);</span>
<span class="nc" id="L135">        employee.setBirthDate(birthDate);</span>
<span class="nc" id="L136">        employee.setPassword(password);</span>
<span class="nc" id="L137">        employee.setHireDate(hireDate);</span>
<span class="nc" id="L138">        employee.setNumberOfChildren(numberOfChildren);</span>
<span class="nc" id="L139">        employee.setSalary(salary);</span>
<span class="nc" id="L140">        employee.setEmail(email);</span>
<span class="nc" id="L141">        employee.setPhone(phone);</span>
<span class="nc" id="L142">        employee.setDepartment(department);</span>
<span class="nc" id="L143">        employee.setPosition(position);</span>

        // Ajouter les vacances à l'employé
<span class="nc" id="L146">        employee.setVacationDays(vacationDays);</span>
<span class="nc" id="L147">        employee.setVacationTaken(vacationTaken);</span>

<span class="nc" id="L149">        return employee;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>